<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Persistent Notion Timer</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: transparent;
      text-align: center;
      margin: 0;
      padding: 12px;
    }

    #timer {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    button {
      font-size: 12px;
      padding: 6px 10px;
      margin: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="timer">0M 0D 0H 0M 0S</div>

  <button onclick="startTimer()">Start</button>
  <button onclick="resetTimer()">Reset</button>

  <!-- Firebase SDKs (compat = simplest, stable) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    /* ================================
       1. FIREBASE CONFIG (PASTE YOURS)
       ================================ */
    const firebaseConfig = {
      apiKey: "AIzaSyClohsSAkMTeYCqq_PRK_F5aSfpPupTaJM",
      authDomain: "notion-persistent-timer.firebaseapp.com",
      projectId: "notion-persistent-timer",
      storageBucket: "notion-persistent-timer.firebasestorage.app",
      messagingSenderId:  "358621702162",
      appId: "1:358621702162:web:127f2c1fb57e9e1f0390cb"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /* ================================
       2. FIRESTORE REFERENCE
       ================================ */
    const timerRef = db.collection("timers").doc("notionTimer");

    let startTime = null;

    /* ================================
       3. LOAD TIMER ON PAGE LOAD
       ================================ */
    async function loadTimer() {
      try {
        const doc = await timerRef.get();
        if (doc.exists && doc.data().startTime) {
          startTime = doc.data().startTime;
        }
      } catch (err) {
        console.error("Failed to load timer:", err);
      }
    }

    /* ================================
       4. START TIMER (ONE-TIME WRITE)
       ================================ */
    async function startTimer() {
      if (startTime !== null) return;

      startTime = Date.now();
      await timerRef.set({ startTime });
    }

    /* ================================
       5. RESET TIMER
       ================================ */
    async function resetTimer() {
      startTime = null;
      await timerRef.delete();
    }

    /* ================================
       6. DISPLAY UPDATE LOOP
       ================================ */
    function updateDisplay() {
      if (!startTime) {
        document.getElementById("timer").textContent =
          "0M 0D 0H 0M 0S";
        return;
      }

      const diff = Date.now() - startTime;

      const totalSeconds = Math.floor(diff / 1000);
      const seconds = totalSeconds % 60;

      const totalMinutes = Math.floor(totalSeconds / 60);
      const minutes = totalMinutes % 60;

      const totalHours = Math.floor(totalMinutes / 60);
      const hours = totalHours % 24;

      const totalDays = Math.floor(totalHours / 24);
      const days = totalDays % 30;

      const months = Math.floor(totalDays / 30);

      document.getElementById("timer").textContent =
        `${months}M ${days}D ${hours}H ${minutes}M ${seconds}S`;
    }

    /* ================================
       7. INIT
       ================================ */
    loadTimer();
    setInterval(updateDisplay, 1000);
  </script>

</body>
</html>
