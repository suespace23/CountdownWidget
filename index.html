<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Recovery Countdown</title>

<style>
:root {
  --card:#f7f7f7; --text:#000; --sub:#666;
  --bar-bg:#e6d9fa; --bar:#9b5cf6;
}
@media (prefers-color-scheme: dark) {
  :root {
    --card:#121212; --text:#fff; --sub:#aaa;
    --bar-bg:#2a183d; --bar:#9b5cf6;
  }
}
body {
  margin:0; background:transparent;
  font-family:system-ui,-apple-system;
  color:var(--text);
}
.card {
  background:var(--card);
  border-radius:20px;
  padding:20px;
  max-width:720px;
  margin:auto;
}
.title {
  font-size:22px;
  font-weight:600;
  margin-bottom:18px;
  display:flex;
  gap:10px;
}
.grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
}
.num {
  font-size:40px;
  font-weight:700;
  transition:transform .25s,opacity .25s;
}
.num.flip { transform:translateY(-6px); opacity:.6; }
.label { color:var(--sub); }
.bar {
  height:12px; background:var(--bar-bg);
  border-radius:6px; overflow:hidden; margin-top:8px;
}
.fill {
  height:100%; background:var(--bar);
  transition:width .6s ease;
}
@keyframes pulse {
  0%{box-shadow:0 0 0 0 rgba(155,92,246,.6)}
  70%{box-shadow:0 0 0 12px rgba(155,92,246,0)}
  100%{box-shadow:0 0 0 0 rgba(155,92,246,0)}
}
.card.pulse { animation:pulse .9s ease-out; }
</style>
</head>

<body>
<div class="card">
  <div class="title">☁️ <span id="challenge">Loading…</span></div>
  <div class="grid">
    <div><div class="num" id="sec">0</div><div class="label">sec</div><div class="bar"><div class="fill" id="secBar"></div></div></div>
    <div><div class="num" id="min">0</div><div class="label">min</div><div class="bar"><div class="fill" id="minBar"></div></div></div>
    <div><div class="num" id="hr">0</div><div class="label">hr</div><div class="bar"><div class="fill" id="hrBar"></div></div></div>
    <div><div class="num" id="day">0</div><div class="label">day</div><div class="bar"><div class="fill" id="dayBar"></div></div></div>
  </div>
</div>

<script>
const DATA_URL = "https://hook.eu2.make.com/2bcftk5c7has4u2f1rjk95oj3xrbkbi5";

let lastRelapse=null, prev=null, started=false;
let prevVals={sec:null,min:null,hr:null,day:null};

function flip(id,val){
  if(prevVals[id]===val) return;
  const el=document.getElementById(id);
  el.classList.add("flip");
  setTimeout(()=>{el.textContent=val; el.classList.remove("flip");},120);
  prevVals[id]=val;
}

function update(){
  if(!lastRelapse) return;
  const d=Math.floor((Date.now()-new Date(lastRelapse))/1000);
  const sec=d%60, min=Math.floor(d/60)%60, hr=Math.floor(d/3600)%24, day=Math.floor(d/86400);
  flip("sec",sec); flip("min",min); flip("hr",hr); flip("day",day);
  secBar.style.width=sec/60*100+"%";
  minBar.style.width=min/60*100+"%";
  hrBar.style.width=hr/24*100+"%";
  dayBar.style.width=Math.min(day/30,1)*100+"%";
}

fetch(DATA_URL,{method:"POST"})
.then(r=>r.json())
.then(data=>{
  prev=lastRelapse;
  lastRelapse=data.lastRelapse;
  challenge.textContent=data.name;
  if(prev && prev!==lastRelapse){
    card.classList.remove("pulse");
    void card.offsetWidth;
    card.classList.add("pulse");
  }
  if(!started){
    started=true;
    update();
    setInterval(update,1000);
  }
});
</script>
</body>
</html>
